<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width">
  <title>LForms Test Page</title>
  <base href="/">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <!-- compiled css file for the web comoponet of LHC-Forms -->
  <link rel="stylesheet" href="../styles.css">
  <style>
    .btn {
      display: inline-block;
      margin: 1px;
      font-weight: normal;
      text-align: center;
      white-space: nowrap;
      vertical-align: middle;
      border: 1px solid transparent;
      padding: 2px 6px;
      font-size: 12px;
      border-radius: 4px;
    }

    .btn-success {
      color: #fff;
      background-color: #5cb85c;
      border-color: #4cae4c;
    }

    .btn-primary {
      color: #fff;
      background-color: #337ab7;
      border-color: #2e6da4;
    }

    .hide {
      display: none;
    }
  </style>
</head>

<body style="padding: 1em">

  <div id="lforms-form">
    <div class="panel panel-default">
      <h3 class="panel-heading">User Page</h3>
      <div class="panel-body">
        <p>아래를 입력해주세요.</p>
        <br><br>


        <input type="file" id="fileAnchor" onchange="loadFile(event)" class="hide" />
        <button id="loadBtn" type="button" class="btn btn-success" onclick="document.querySelector('#fileAnchor').click()">Load From File</button>

      </div>
    </div>

    <br><br>
    <wc-lhc-form id='test-form'></wc-lhc-form>

  </div>
  <div id="myFormContainer"></div>




    <script type="text/javascript">

      /**
       * Get FHIR version from the version list
       */
      function getFHIRVersion() {
        return "R4";
      }

      /**
       * Get FHIR context from the globale object LForms
       */
      function getFHIR() {
        return LForms.FHIR["R4"];
      }


      /**
       * Get SDC 'Questionnaire' data from the form and display it in console
       */
      function showFHIRSDCQuestionnaire() {
        if (testForm.questionnaire) {
          var fhir = getFHIR();
          var sdc = fhir.SDC.convertLFormsToQuestionnaire(testForm.questionnaire);
          var fhirString = JSON.stringify(sdc, null, 4);
          console.log(fhirString);
        }
      }

      /**
       * Get 'Questionnaire' data from the form and display it in console
       */
      function showFHIRQuestionnaire() {
        if (testForm.questionnaire) {
          var sdc = getFHIR().SDC.convertLFormsToQuestionnaire(testForm.questionnaire, true);
          var fhirString = JSON.stringify(sdc, null, 4);
          console.log(fhirString);
        }
      }


      /**
       * Load a data file from local file system
       */
      function loadFile(event) {
        var reader = new FileReader();
        var fileAnchor = document.querySelector('#fileAnchor');
        reader.onload = function() {
          var questionnaire = JSON.parse(reader.result);
          var fhirVersion = "R4";
          // var formData = LForms.Util.convertFHIRQuestionnaireToLForms(questionnaire, fhirVersion)
          // var mergedData = LForms.Util.mergeFHIRDataIntoLForms(questionnaire, formData, fhirVersion)
          // LForms.Util.addFormToPage(mergedData, 'myFormContainer');
          LForms.Util.addFormToPage(questionnaire, 'myFormContainer');
        };
        reader.readAsText(event.target.files[0]);

      }


    </script>

    <!-- zone.js is not included in LHC-Forms web component -->
    <script src="/assets/lib/zone.min.js"></script>
    <!-- ES2015 files of the LHC-Forms web component -->
    <script src="../runtime.js"></script>
    <script src="../polyfills.js"></script>
    <script src="../scripts.js" ></script>
    <script src="../main.js"></script>

  <script src="https://clinicaltables.nlm.nih.gov/lforms-versions/32.1.0/fhir/R4/lformsFHIR.min.js"></script>

  </body>
</html>
